{% extends "base.html" %}
{% block title %}Explorar · Alma Viajera{% endblock %}
{% block body_class %}explorer{% endblock %}
{% block content %}
<div class="container py-4">
  <h1 class="h3 mb-3">Explorar</h1>

  <form class="row g-2 mb-4">
    <div class="col-md-4"><input class="form-control" name="q" value="{{ request.GET.q }}" placeholder="Buscar..."></div>
    <div class="col-md-2"><input class="form-control" name="country" value="{{ request.GET.country }}" placeholder="País"></div>
    <div class="col-md-2"><input class="form-control" name="city" value="{{ request.GET.city }}" placeholder="Ciudad/Pueblo"></div>
    <div class="col-md-2"><input class="form-control" name="min_price" value="{{ request.GET.min_price }}" placeholder="Precio mín (servicios)"></div>
    <div class="col-md-2"><input class="form-control" name="max_price" value="{{ request.GET.max_price }}" placeholder="Precio máx (servicios)"></div>
    <div class="col-12">
      <button class="btn btn-primary">Filtrar</button>
      <a class="btn btn-outline-secondary" href="{% url 'listings:explorer' %}">Limpiar</a>
    </div>
  </form>

  <ul class="nav nav-tabs mb-3">
    <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-places" type="button">Lugares</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-products" type="button">Productos</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-services" type="button">Servicios</button></li>
  </ul>

  <div class="tab-content">
    <!-- Lugares -->
    <div class="tab-pane fade show active" id="tab-places">
      <div class="row g-4">
        {% for p in places %}
          <div class="col-12 col-sm-6 col-lg-4">
            <div class="card h-100">
              {% if p.image_url %}<img src="{{ p.image_url }}" class="card-img-top" alt="{{ p.title }}">{% endif %}
              <div class="card-body">
                <h5 class="card-title">{{ p.title }}</h5>
                <p class="card-text small text-muted">{{ p.location }}</p>
                <p class="card-text">{{ p.description|truncatechars:120 }}</p>
                <span class="badge text-bg-warning">★ {{ p.rating }}</span>
              </div>
            </div>
          </div>
        {% empty %}
          <p>No hay lugares con los filtros aplicados.</p>
        {% endfor %}
      </div>
    </div>

    <!-- Productos -->
    <div class="tab-pane fade" id="tab-products">
      <div class="row g-4">
        {% for pr in products %}
          <div class="col-12 col-sm-6 col-lg-4">
            <div class="card h-100">
              {% if pr.image_url %}<img src="{{ pr.image_url }}" class="card-img-top" alt="{{ pr.name }}">{% endif %}
              <div class="card-body">
                <h5 class="card-title">{{ pr.name }}</h5>
                <p class="card-text small text-muted">{{ pr.location }}</p>
                <p class="card-text">{{ pr.description|truncatechars:120 }}</p>
                {% if pr.where_to_buy %}<span class="badge text-bg-info">Dónde: {{ pr.where_to_buy }}</span>{% endif %}
              </div>
            </div>
          </div>
        {% empty %}
          <p>No hay productos con los filtros aplicados.</p>
        {% endfor %}
      </div>
    </div>

    <!-- Servicios -->
    <div class="tab-pane fade" id="tab-services">
      <div class="row g-4">
        {% for s in services %}
          <div class="col-12 col-sm-6 col-lg-4">
            <div class="card h-100">
              {% if s.image_url %}<img src="{{ s.image_url }}" class="card-img-top" alt="{{ s.title }}">{% endif %}
              <div class="card-body">
                <h5 class="card-title">{{ s.title }}</h5>
                <p class="card-text small text-muted">{{ s.location }}</p>
                <p class="card-text">{{ s.description|truncatechars:120 }}</p>
                {% if s.price_from %}<span class="badge text-bg-success">Desde ${{ s.price_from }}</span>{% endif %}
              </div>
            </div>
          </div>
        {% empty %}
          <p>No hay servicios con los filtros aplicados.</p>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock %}