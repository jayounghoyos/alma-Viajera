{% extends 'base.html' %}

{% load static %}
{% load custom_filters %}
{% load i18n %}

{% block title %}{{ item.nombre }}{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/item_detail.css' %}">
<link rel="stylesheet" href="{% static 'css/calificacion.css' %}">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

<div class="product-container">
    <div class="product-image">
        <img src="{{ item.imagen.url }}" alt="{{ item.nombre }}">
    </div>
    <div class="product-details-container">
        <div class="product-details">
            <h1 class="product-title">{{ item.nombre }}</h1>

            <!-- Mostrar promedio de calificación con estrellas -->
            <div class="product-rating">
                <div class="stars-display">
                    {% for i in estrellas.llenas|to_range %}
                        <i class="fas fa-star"></i>
                    {% endfor %}
                    {% if estrellas.media %}
                        <i class="fas fa-star-half-alt"></i>
                    {% endif %}
                    {% for i in estrellas.vacias|to_range %}
                        <i class="far fa-star"></i>
                    {% endfor %}
                </div>
                <span>{{ promedio_calificacion }} / 5</span>
            </div>

            <div class="product-info">
                <div class="info-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>{{ item.ubicacion }}</span>
                </div>
                <div class="info-item">
                    <i class="fas fa-clock"></i>
                    <span>{{ item.tiempo }} {% trans "horas" %}</span>
                </div>
            </div>

            <p class="product-description">
                {{ item.descripcion }}
            </p>

            <div class="product-price">
                <span class="price-value">${{ item.precio }}</span>
                <span class="price-currency">{% trans "COP" %}</span>
            </div>

            <div class="product-availability">
                {% if item.disponibilidad %}
                    <i class="fas fa-check-circle"></i>
                    <span>{% trans "Disponible" %}</span>
                {% else %}
                    <i class="fas fa-times-circle"></i>
                    <span>{% trans "No Disponible" %}</span>
                {% endif %}
            </div>

            <form action="{% url 'cart:agregar_al_carrito' item.id %}" method="post">
                {% csrf_token %}
                <button type="submit" class="add-to-cart-button">{% trans "Añadir al Carrito" %}</button>
            </form>
        </div>
    </div>
</div>

<!-- Formulario para calificar -->
<!-- File: `apps/catalog/templates/catalog/item_detail.html` (sólo el bloque de calificación) -->
<div class="product-rating-form">
    {% if user.is_authenticated %}
        <h3>{% trans "Califica este producto" %}</h3>
        <form method="post">
            {% csrf_token %}

            <div class="rating-stars">
                {% for i in "54321" %}
                    <input type="radio" id="star{{ i }}" name="puntuacion" value="{{ i }}">
                    <label for="star{{ i }}">&#9733;</label>
                {% endfor %}
            </div>


            <button type="submit">{% trans "Calificar" %}</button>
        </form>
    {% else %}
        <p>{% trans "Inicia sesión para calificar este producto." %}</p>
    {% endif %}
</div>

<!-- Mostrar calificaciones -->
<div class="product-reviews">
    <h3>{% trans "Reseñas:" %}</h3>
    {% for calificacion in calificaciones %}
        <div class="review">
            <p><strong>{{ calificacion.usuario }}</strong> - {{ calificacion.puntuacion }} ★</p>
            <p>{{ calificacion.comentario }}</p>
            <p><small>{{ calificacion.fecha|date:"d M Y H:i" }}</small></p>
        </div>
    {% empty %}
        <p>{% trans "No hay calificaciones aún." %}</p>
    {% endfor %}
</div>
{% endblock %}
